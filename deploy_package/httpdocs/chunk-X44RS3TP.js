import{o as T}from"./chunk-RJZUVJYA.js";import{a as A}from"./chunk-SPG2DMMT.js";import{a as I}from"./chunk-RPL4CNPF.js";import{j as P,k as w,m as E,n as V}from"./chunk-H6O6N7HE.js";import{Gb as y,Ha as c,Ib as a,Jb as b,Kb as u,Lb as M,Ub as S,Va as h,X as v,Xb as O,_a as _,aa as m,ba as p,jb as l,kb as n,lb as o,mb as k,na as C,sb as x,wb as f,xb as d}from"./chunk-ASF4LTZT.js";function D(s,t){s&1&&(n(0,"div",6),k(1,"div",7),n(2,"p"),a(3,"Cargando sesiones pendientes..."),o()())}function L(s,t){s&1&&(n(0,"div",8)(1,"div",9),a(2,"\u2728"),o(),n(3,"h3"),a(4,"\xA1Todo al d\xEDa!"),o(),n(5,"p"),a(6,"No hay entrenamientos pendientes de revisi\xF3n."),o()())}function N(s,t){s&1&&(n(0,"span",29),a(1,"check_circle"),o())}function $(s,t){s&1&&(n(0,"span",30),a(1,"radio_button_unchecked"),o())}function K(s,t){if(s&1){let e=x();n(0,"div",22),f("click",function(){let i=m(e).$implicit,g=d().$implicit,z=d(2);return p(z.toggleCheck(g,i.id))}),n(1,"div",23),_(2,N,2,0,"span",24)(3,$,2,0,"span",25),o(),n(4,"div",26)(5,"span",27),a(6),o(),n(7,"span",28),a(8),o()()()}if(s&2){let e=t.$implicit,r=d().$implicit,i=d(2);y("unchecked",!i.isChecked(r,e.id)),c(2),l("ngIf",i.isChecked(r,e.id)),c(),l("ngIf",!i.isChecked(r,e.id)),c(3),u("\u{1F436} ",(e.dog==null?null:e.dog.name)||"Perro Desconocido"),c(2),u("Due\xF1o: ",(e.user==null?null:e.user.name)||"Usuario")}}function j(s,t){if(s&1){let e=x();n(0,"div",12)(1,"div",13)(2,"div",14)(3,"span",15),a(4),S(5,"date"),o(),n(6,"span",16),a(7),o()(),n(8,"div",17),a(9),o()(),n(10,"div",18),_(11,K,9,6,"div",19),o(),n(12,"div",20)(13,"button",21),f("click",function(){let i=m(e).$implicit,g=d(2);return p(g.openConfirmModal(i))}),a(14," Confirmar Asistencia "),o()()()}if(s&2){let e=t.$implicit;c(4),b(O(5,5,e.date,"EEEE, d MMMM","","es-ES")),c(3),M("",e.slot.start_time," - ",e.slot.end_time),c(2),u(" ",e.reservations.length," reservas "),c(2),l("ngForOf",e.reservations)}}function U(s,t){if(s&1&&(n(0,"div",10),_(1,j,15,10,"div",11),o()),s&2){let e=d();c(),l("ngForOf",e.pendingSessions())}}function Y(s,t){if(s&1){let e=x();n(0,"div",31),f("click",function(){m(e);let i=d();return p(i.closeConfirmModal())}),n(1,"div",32),f("click",function(i){return m(e),p(i.stopPropagation())}),n(2,"div",33)(3,"h2"),a(4,"Confirmar Asistencia"),o(),n(5,"button",34),f("click",function(){m(e);let i=d();return p(i.closeConfirmModal())}),a(6,"\u2715"),o()(),n(7,"div",35)(8,"p"),a(9,"Vas a confirmar la asistencia de "),n(10,"strong"),a(11),o(),a(12," perros."),o(),n(13,"p",36),a(14,"Se asignar\xE1 +1 punto al ranking de cada perrete confirmado."),o(),n(15,"div",37)(16,"span",38),a(17,"info"),o(),n(18,"p"),a(19,'Las personas no marcadas se registrar\xE1n como "No Asistido" y no recibir\xE1n puntos.'),o()()(),n(20,"div",39)(21,"button",40),f("click",function(){m(e);let i=d();return p(i.closeConfirmModal())}),a(22,"Cancelar"),o(),n(23,"button",41),f("click",function(){m(e);let i=d();return p(i.executeConfirm())}),a(24,"Confirmar y Asignar Puntos"),o()()()()}if(s&2){let e=d();c(11),b(e.attendeesCountFn)}}var F=class s{reservationService=v(I);toastService=v(A);pendingSessions=C([]);isLoading=C(!0);checkedState=new Map;isConfirmModalOpen=!1;sessionToConfirm=null;attendeesCountFn=0;constructor(){this.loadPending()}loadPending(){this.isLoading.set(!0),this.reservationService.getPendingAttendance().subscribe({next:t=>{this.pendingSessions.set(t),this.initializeChecks(t),this.isLoading.set(!1)},error:t=>{console.error("Error loading pending attendance",t),this.isLoading.set(!1)}})}initializeChecks(t){this.checkedState.clear(),t.forEach(e=>{let r=this.getSessionKey(e),i=new Set;e.reservations.forEach(g=>i.add(g.id)),this.checkedState.set(r,i)})}getSessionKey(t){return`${t.date}_${t.slot?.id}`}isChecked(t,e){let r=this.getSessionKey(t);return this.checkedState.get(r)?.has(e)||!1}toggleCheck(t,e){let r=this.getSessionKey(t),i=this.checkedState.get(r);i&&(i.has(e)?i.delete(e):i.add(e))}openConfirmModal(t){let e=this.getSessionKey(t),r=Array.from(this.checkedState.get(e)||[]);this.sessionToConfirm=t,this.attendeesCountFn=r.length,this.isConfirmModalOpen=!0}closeConfirmModal(){this.isConfirmModalOpen=!1,this.sessionToConfirm=null}executeConfirm(){if(!this.sessionToConfirm)return;let t=this.sessionToConfirm,e=this.getSessionKey(t),r=Array.from(this.checkedState.get(e)||[]);this.reservationService.confirmAttendance({date:t.date,slot_id:t.slot.id,attended_ids:r}).subscribe({next:()=>{this.toastService.success("Asistencia confirmada correctamente"),this.pendingSessions.update(i=>i.filter(g=>this.getSessionKey(g)!==e)),this.closeConfirmModal()},error:i=>{console.error("Error confirming attendance",i),this.toastService.error("Error al confirmar asistencia"),this.closeConfirmModal()}})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=h({type:s,selectors:[["app-attendance-verification"]],decls:10,vars:4,consts:[[1,"attendance-container"],[1,"header"],["class","loading-state",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","sessions-list",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"loading-state"],[1,"spinner"],[1,"empty-state"],[1,"icon-check"],[1,"sessions-list"],["class","session-card",4,"ngFor","ngForOf"],[1,"session-card"],[1,"session-header"],[1,"date-info"],[1,"date"],[1,"time"],[1,"count-badge"],[1,"attendees-list"],["class","attendee-row",3,"unchecked","click",4,"ngFor","ngForOf"],[1,"card-actions"],[1,"btn-confirm",3,"click"],[1,"attendee-row",3,"click"],[1,"checkbox-custom"],["class","material-icons",4,"ngIf"],["class","material-icons unchecked-icon",4,"ngIf"],[1,"attendee-info"],[1,"attendee-name"],[1,"attendee-dogs"],[1,"material-icons"],[1,"material-icons","unchecked-icon"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"modal-body"],[1,"subtext"],[1,"info-box"],[1,"material-icons","info-icon"],[1,"modal-actions"],[1,"btn-cancel",3,"click"],[1,"btn-confirm-modal",3,"click"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1"),a(3,"\u2705 Verificaci\xF3n de Asistencia"),o(),n(4,"p"),a(5,"Confirma qui\xE9n asisti\xF3 para asignar puntos."),o()(),_(6,D,4,0,"div",2)(7,L,7,0,"div",3)(8,U,2,1,"div",4),o(),_(9,Y,25,1,"div",5)),e&2&&(c(6),l("ngIf",r.isLoading()),c(),l("ngIf",!r.isLoading()&&r.pendingSessions().length===0),c(),l("ngIf",!r.isLoading()&&r.pendingSessions().length>0),c(),l("ngIf",r.isConfirmModalOpen))},dependencies:[V,P,w,T,E],styles:[".attendance-container[_ngcontent-%COMP%]{max-width:800px;margin:2rem auto;padding:1rem}.header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.8rem;color:var(--text-main)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 1rem;background:#f8fafc;border-radius:20px;border:2px dashed #e2e8f0}.icon-check[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:1rem}.sessions-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.session-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;box-shadow:0 4px 6px -1px #0000001a;border:1px solid #e2e8f0;overflow:hidden}.session-header[_ngcontent-%COMP%]{background:#f1f5f9;padding:1rem 1.5rem;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #e2e8f0}.date-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.date[_ngcontent-%COMP%]{font-weight:700;color:var(--text-main);text-transform:capitalize}.time[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.9rem}.attendees-list[_ngcontent-%COMP%]{padding:1rem;display:flex;flex-direction:column;gap:8px}.attendee-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:10px;border-radius:8px;border:1px solid #e2e8f0;cursor:pointer;transition:all .2s;background:#f8fafc}.attendee-row[_ngcontent-%COMP%]:hover{background:#f0f9ff;border-color:var(--primary-blue)}.attendee-row.unchecked[_ngcontent-%COMP%]{opacity:.6;background:#fff}.checkbox-custom[_ngcontent-%COMP%]{color:var(--primary-blue);display:flex;align-items:center}.unchecked-icon[_ngcontent-%COMP%]{color:var(--text-light)}.attendee-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.attendee-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-main)}.attendee-dogs[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-secondary)}.card-actions[_ngcontent-%COMP%]{padding:1rem 1.5rem;border-top:1px solid #e2e8f0;display:flex;justify-content:flex-end}.btn-confirm[_ngcontent-%COMP%]{background:var(--primary-blue);color:#fff;border:none;padding:10px 24px;border-radius:8px;font-weight:600;cursor:pointer;transition:background .2s}.btn-confirm[_ngcontent-%COMP%]:hover{background:#005bb5}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:2rem}.spinner[_ngcontent-%COMP%]{width:30px;height:30px;border:3px solid #f3f3f3;border-top:3px solid var(--primary-blue);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 10px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:0;border-radius:16px;width:90%;max-width:450px;box-shadow:0 10px 25px #0003;animation:_ngcontent-%COMP%_slideUp .3s cubic-bezier(.16,1,.3,1);overflow:hidden}.modal-header[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;align-items:center}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;color:var(--text-main)}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:1.5rem;color:var(--text-light);cursor:pointer;padding:.5rem;line-height:1}.modal-body[_ngcontent-%COMP%]{padding:1.5rem;color:var(--text-main)}.subtext[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.95rem;margin-top:.5rem}.info-box[_ngcontent-%COMP%]{background:#eff6ff;border:1px solid #bfdbfe;border-radius:8px;padding:1rem;margin-top:1.5rem;display:flex;gap:12px;align-items:flex-start}.info-icon[_ngcontent-%COMP%]{color:var(--primary-blue);font-size:1.2rem}.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:#1e3a8a;margin:0}.modal-actions[_ngcontent-%COMP%]{padding:1.5rem;background:#f8fafc;border-top:1px solid #f1f5f9;display:flex;justify-content:flex-end;gap:1rem}.btn-cancel[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;color:var(--text-main);padding:10px 20px;border-radius:8px;font-weight:600;cursor:pointer;transition:all .2s}.btn-cancel[_ngcontent-%COMP%]:hover{background:#f1f5f9}.btn-confirm-modal[_ngcontent-%COMP%]{background:var(--primary-blue);color:#fff;border:none;padding:10px 24px;border-radius:8px;font-weight:600;cursor:pointer;box-shadow:0 4px 6px -1px #2563eb33;transition:all .2s}.btn-confirm-modal[_ngcontent-%COMP%]:hover{background:#005bb5;transform:translateY(-1px)}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}"]})};export{F as AttendanceVerificationComponent};
