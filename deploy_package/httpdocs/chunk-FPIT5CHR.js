import{c as M,d as O,f as y,g as w,h as k,i as E}from"./chunk-SQFYRXBB.js";import{a as N}from"./chunk-DVJK4UK6.js";import{h as z}from"./chunk-MYXBRZBT.js";import{j as D,k as V,n as U,v as j,y as F}from"./chunk-H6O6N7HE.js";import{Ea as P,Eb as T,Ha as s,Ib as u,Jb as A,Kb as I,S,Va as G,X as f,_a as _,aa as d,ba as m,jb as p,kb as r,lb as l,mb as b,na as h,sb as x,wb as g,xb as c}from"./chunk-ASF4LTZT.js";var v=class o{http=f(j);apiUrl=F.apiUrl;getPhotos(){return this.http.get(`${this.apiUrl}/gallery`)}uploadPhoto(n,e){let t=new FormData;return t.append("photo",n),e&&t.append("alt",e),this.http.post(`${this.apiUrl}/gallery`,t)}deletePhoto(n){return this.http.delete(`${this.apiUrl}/gallery/${n}`)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=S({token:o,factory:o.\u0275fac,providedIn:"root"})};function Y(o,n){o&1&&b(0,"i",11)}function R(o,n){if(o&1){let e=x();r(0,"div",7)(1,"input",8,0),g("change",function(i){d(e);let a=c();return m(a.onFileSelected(i))}),l(),r(3,"button",9),g("click",function(){d(e);let i=T(2);return m(i.click())}),_(4,Y,1,0,"i",10),u(5),l()()}if(o&2){let e=c();s(3),p("disabled",e.isUploading()),s(),p("ngIf",!e.isUploading()),s(),I(" ",e.isUploading()?"Subiendo...":"A\xF1adir nueva foto"," ")}}function q(o,n){if(o&1){let e=x();r(0,"button",16),g("click",function(i){d(e);let a=c().$implicit,C=c();return m(C.deletePhoto(a.id,i))}),u(1," \xD7 "),l()}}function B(o,n){if(o&1){let e=x();r(0,"div",12),g("click",function(){let i=d(e).index,a=c();return m(a.openLightbox(i))}),b(1,"img",13),_(2,q,2,0,"button",14),r(3,"div",15)(4,"span"),u(5),l()()()}if(o&2){let e=n.$implicit,t=c();s(),p("src",e.url,P)("alt",e.alt),s(),p("ngIf",t.isStaff()),s(3),A(e.alt)}}function H(o,n){if(o&1){let e=x();r(0,"div",17),g("click",function(){d(e);let i=c();return m(i.closeLightbox())}),r(1,"div",18),g("click",function(i){return d(e),m(i.stopPropagation())}),r(2,"button",19),g("click",function(){d(e);let i=c();return m(i.closeLightbox())}),u(3,"\xD7"),l(),r(4,"button",20),g("click",function(i){d(e);let a=c();return m(a.prevImage(i))}),u(5,"\u276E"),l(),b(6,"img",21),r(7,"button",22),g("click",function(i){d(e);let a=c();return m(a.nextImage(i))}),u(8,"\u276F"),l(),r(9,"div",23),u(10),l()()()}if(o&2){let e=c();s(6),p("src",e.images()[e.currentImageIndex()].url,P)("alt",e.images()[e.currentImageIndex()].alt),s(4),I(" ",e.images()[e.currentImageIndex()].alt," ")}}var $=class o{images=h([]);lightboxOpen=h(!1);currentImageIndex=h(0);isUploading=h(!1);galleryService=f(v);authService=f(z);imageCompressor=f(N);isStaff=this.authService.isStaff;ngOnInit(){this.loadPhotos()}loadPhotos(){this.galleryService.getPhotos().subscribe({next:n=>{this.images.set(n)},error:n=>console.error("Error loading gallery photos",n)})}async onFileSelected(n){let e=n.target.files?.[0];if(e){this.isUploading.set(!0);try{let t=await this.imageCompressor.compress(e),i=prompt("Introduce un t\xEDtulo alternativo para la foto (opcional):")||"Foto de galer\xEDa";this.galleryService.uploadPhoto(t,i).subscribe({next:a=>{this.images.update(C=>[a,...C]),this.isUploading.set(!1)},error:a=>{console.error("Error uploading photo",a),this.isUploading.set(!1),alert("Error al subir la foto")}})}catch(t){console.error("Compression error",t),this.isUploading.set(!1),alert("Error al comprimir la foto")}}n.target.value=""}deletePhoto(n,e){e.stopPropagation(),confirm("\xBFEst\xE1s seguro de que deseas eliminar esta foto destacada?")&&this.galleryService.deletePhoto(n).subscribe({next:()=>{this.images.update(t=>t.filter(i=>i.id!==n)),this.lightboxOpen()&&this.closeLightbox()},error:t=>{console.error("Error deleting photo",t),alert("Error al eliminar la foto")}})}openLightbox(n){this.currentImageIndex.set(n),this.lightboxOpen.set(!0),document.body.style.overflow="hidden"}closeLightbox(){this.lightboxOpen.set(!1),document.body.style.overflow="auto"}nextImage(n){n?.stopPropagation();let e=this.currentImageIndex(),t=this.images().length;this.currentImageIndex.set((e+1)%t)}prevImage(n){n?.stopPropagation();let e=this.currentImageIndex(),t=this.images().length;this.currentImageIndex.set((e-1+t)%t)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=G({type:o,selectors:[["app-galeria"]],decls:9,vars:4,consts:[["fileInput",""],[1,"gallery-container"],[1,"subtitle"],["class","admin-actions",4,"ngIf"],[1,"gallery-masonry"],["class","gallery-item",3,"click",4,"ngFor","ngForOf"],["class","lightbox",3,"click",4,"ngIf"],[1,"admin-actions"],["type","file","accept","image/*",2,"display","none",3,"change"],[1,"btn-upload",3,"click","disabled"],["class","fas fa-upload",4,"ngIf"],[1,"fas","fa-upload"],[1,"gallery-item",3,"click"],["loading","lazy",3,"src","alt"],["class","delete-btn","title","Eliminar foto",3,"click",4,"ngIf"],[1,"overlay"],["title","Eliminar foto",1,"delete-btn",3,"click"],[1,"lightbox",3,"click"],[1,"lightbox-content",3,"click"],[1,"close-btn",3,"click"],[1,"nav-btn","prev",3,"click"],[1,"lightbox-img",3,"src","alt"],[1,"nav-btn","next",3,"click"],[1,"lightbox-caption"]],template:function(e,t){e&1&&(r(0,"div",1)(1,"h2"),u(2,"Galer\xEDa"),l(),r(3,"p",2),u(4,"Momentos destacados de nuestro equipo."),l(),_(5,R,6,3,"div",3),r(6,"div",4),_(7,B,6,4,"div",5),l()(),_(8,H,11,3,"div",6)),e&2&&(s(5),p("ngIf",t.isStaff()),s(),p("@listAnimation",t.images().length),s(),p("ngForOf",t.images()),s(),p("ngIf",t.lightboxOpen()))},dependencies:[U,D,V],styles:[".gallery-container[_ngcontent-%COMP%]{padding:2rem 1rem;max-width:1400px;margin:0 auto}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:.5rem;color:var(--primary-blue);font-size:2.5rem}.subtitle[_ngcontent-%COMP%]{text-align:center;color:var(--text-light);margin-bottom:3rem;font-size:1.1rem}.gallery-masonry[_ngcontent-%COMP%]{column-count:3;column-gap:1.5rem}.gallery-item[_ngcontent-%COMP%]{break-inside:avoid;margin-bottom:1.5rem;border-radius:12px;overflow:hidden;box-shadow:0 4px 15px #0000001a;cursor:pointer;position:relative;transition:transform .3s cubic-bezier(.25,.8,.25,1),box-shadow .3s ease}.gallery-item[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 10px 25px #00000026}.gallery-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;display:block;transition:transform .5s ease}.gallery-item[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{transform:scale(1.05)}.overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#0000004d;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .3s ease}.gallery-item[_ngcontent-%COMP%]:hover   .overlay[_ngcontent-%COMP%]{opacity:1}.overlay[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff;font-weight:600;border:1px solid white;padding:.5rem 1rem;border-radius:20px;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.lightbox[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000000e6;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);z-index:1000;display:flex;align-items:center;justify-content:center;animation:_ngcontent-%COMP%_fadeIn .3s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.lightbox-content[_ngcontent-%COMP%]{position:relative;max-width:90%;max-height:90vh;display:flex;flex-direction:column;align-items:center}.lightbox-img[_ngcontent-%COMP%]{max-width:100%;max-height:80vh;border-radius:4px;box-shadow:0 5px 30px #00000080}.lightbox-caption[_ngcontent-%COMP%]{color:#fff;margin-top:1rem;font-size:1.1rem;font-weight:300}.close-btn[_ngcontent-%COMP%]{position:absolute;top:-40px;right:0;background:none;border:none;color:#fff;font-size:2.5rem;cursor:pointer;line-height:1;padding:0}.nav-btn[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%);background:#ffffff1a;border:none;color:#fff;font-size:2rem;cursor:pointer;padding:1rem;border-radius:50%;transition:background .2s}.nav-btn[_ngcontent-%COMP%]:hover{background:#ffffff4d}.prev[_ngcontent-%COMP%]{left:-80px}.next[_ngcontent-%COMP%]{right:-80px}@media(max-width:900px){.gallery-masonry[_ngcontent-%COMP%]{column-count:2}}@media(max-width:600px){.gallery-masonry[_ngcontent-%COMP%]{column-count:1}.nav-btn[_ngcontent-%COMP%]{padding:.5rem;font-size:1.5rem}.prev[_ngcontent-%COMP%]{left:-10px}.next[_ngcontent-%COMP%]{right:-10px}.close-btn[_ngcontent-%COMP%]{top:-30px;right:10px}}.admin-actions[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-bottom:2rem}.btn-upload[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:.8rem 1.5rem;border-radius:25px;font-size:1rem;font-weight:600;cursor:pointer;transition:background-color .3s,transform .2s;box-shadow:0 4px 10px #0000001a}.btn-upload[_ngcontent-%COMP%]:hover:not([disabled]){transform:translateY(-2px);opacity:.9}.btn-upload[disabled][_ngcontent-%COMP%]{opacity:.7;cursor:not-allowed}.delete-btn[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background-color:#f00c;color:#fff;border:none;border-radius:50%;width:35px;height:35px;font-size:1.5rem;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:10;opacity:0;transition:opacity .3s,background-color .2s}.gallery-item[_ngcontent-%COMP%]:hover   .delete-btn[_ngcontent-%COMP%]{opacity:1}.delete-btn[_ngcontent-%COMP%]:hover{background-color:red}"],data:{animation:[M("listAnimation",[w("* => *",[k(":enter",[y({opacity:0,transform:"translateY(20px)"}),E(100,[O("0.5s ease-out",y({opacity:1,transform:"translateY(0)"}))])],{optional:!0})])])]}})};export{$ as GaleriaComponent};
