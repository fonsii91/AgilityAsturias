import{b as p,e as n}from"./chunk-UPS7OBSK.js";import{S as m,X as c,na as l}from"./chunk-FRQHPZYJ.js";var u=class a{http=c(p);apiUrl=`${n.apiUrl}/reservations`;reservationsSignal=l([]);availabilitySignal=l([]);constructor(){this.fetchReservations(),this.fetchAvailability()}fetchReservations(){this.http.get(this.apiUrl).subscribe({next:t=>{let e=t.map(i=>this.mapFromBackend(i));this.reservationsSignal.set(e)},error:t=>console.error("Error fetching reservations",t)})}fetchAvailability(){this.http.get(`${n.apiUrl}/availability`).subscribe({next:t=>{this.availabilitySignal.set(t)},error:t=>console.error("Error fetching availability",t)})}getReservations(){return this.reservationsSignal}getAvailability(){return this.availabilitySignal}addReservation(t){let e={slot_id:t.slotId,user_id:t.userId,date:t.date,dog_ids:t.dogIds};return new Promise((i,r)=>{this.http.post(this.apiUrl,e).subscribe({next:s=>{let d=s.map(o=>this.mapFromBackend(o));this.reservationsSignal.update(o=>[...o,...d]),this.fetchAvailability(),i(d)},error:s=>r(s)})})}deleteReservation(t){return new Promise((e,i)=>{this.http.delete(`${this.apiUrl}/${t}`).subscribe({next:()=>{this.reservationsSignal.update(r=>r.filter(s=>s.id!==t)),this.fetchAvailability(),e()},error:r=>i(r)})})}deleteBlock(t,e){return new Promise((i,r)=>{this.http.delete(`${this.apiUrl}/block?slot_id=${t}&date=${e}`).subscribe({next:()=>{this.fetchReservations(),this.fetchAvailability(),i()},error:s=>r(s)})})}getPendingAttendance(){return this.http.get(`${n.apiUrl}/admin/attendance/pending`)}confirmAttendance(t){return this.http.post(`${n.apiUrl}/admin/attendance/confirm`,t)}getRanking(){return this.http.get(`${n.apiUrl}/ranking`)}mapToBackend(t){return{slot_id:t.slotId,user_id:t.userId,date:t.date}}mapFromBackend(t){let e=t.date&&typeof t.date=="string"?t.date.substring(0,10):t.date;return{id:t.id,slotId:t.slot_id,userId:t.user_id,date:e,dogId:t.dog_id,dog:t.dog,status:t.status,createdAt:t.created_at,user:t.user,timeSlot:t.time_slot||t.timeSlot,userName:t.user?.name||"Usuario",day:t.time_slot?.day||"",startTime:t.time_slot?.start_time||""}}static \u0275fac=function(e){return new(e||a)};static \u0275prov=m({token:a,factory:a.\u0275fac,providedIn:"root"})};export{u as a};
