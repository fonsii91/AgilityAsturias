import{a as B}from"./chunk-37VHQXZU.js";import{a as z,c as U,e as j,o as A}from"./chunk-RJZUVJYA.js";import{a as L}from"./chunk-DVJK4UK6.js";import{h as W}from"./chunk-MYXBRZBT.js";import{a as I}from"./chunk-SPG2DMMT.js";import{i as E,j as N,k as V,l as T,n as F}from"./chunk-H6O6N7HE.js";import{Ea as v,Ha as d,Ib as l,Jb as b,Mb as P,Nb as y,Ob as M,Pb as O,Ub as D,Va as k,Vb as S,X as h,_a as u,aa as s,ba as g,jb as f,kb as r,lb as o,mb as C,na as _,pa as w,sb as x,wb as p,xb as c}from"./chunk-ASF4LTZT.js";function R(a,i){if(a&1){let e=x();r(0,"div",21)(1,"h2"),l(2),o(),r(3,"button",22),p("click",function(){s(e);let t=c(2);return g(t.toggleEditName())}),l(4,"\u270F\uFE0F"),o()()}if(a&2){let e=c().ngIf;d(2),b(e.displayName)}}function J(a,i){if(a&1){let e=x();r(0,"div",23)(1,"input",24),M("ngModelChange",function(t){s(e);let m=c(2);return y(m.editedName,t)||(m.editedName=t),g(t)}),p("keyup.enter",function(){s(e);let t=c(2);return g(t.saveName())}),o(),r(2,"div",25)(3,"button",26),p("click",function(){s(e);let t=c(2);return g(t.saveName())}),l(4,"\u2705"),o(),r(5,"button",27),p("click",function(){s(e);let t=c(2);return g(t.toggleEditName())}),l(6,"\u274C"),o()()()}if(a&2){let e=c(2);d(),P("ngModel",e.editedName)}}function K(a,i){a&1&&(r(0,"div",28)(1,"p"),l(2,"A\xFAn no has a\xF1adido ning\xFAn perro."),o()())}function G(a,i){if(a&1&&C(0,"img",37),a&2){let e=c().$implicit;f("alt",O(e.name))("src",e.photo_url,v)}}function H(a,i){a&1&&(r(0,"div",38),l(1,"\u{1F415}"),o())}function Q(a,i){if(a&1){let e=x();r(0,"div",29)(1,"div",30),u(2,G,1,3,"img",31)(3,H,2,0,"div",32),r(4,"label",33),l(5," \u{1F4F7} "),r(6,"input",6),p("change",function(t){let m=s(e).$implicit,q=c(2);return g(q.onDogFileSelected(t,m.id))}),o()()(),r(7,"div",34)(8,"span",35),l(9),o()(),r(10,"button",36),p("click",function(){let t=s(e).$implicit,m=c(2);return g(m.deleteDog(t.id,t.name))}),l(11,"\u{1F5D1}\uFE0F"),o()()}if(a&2){let e=i.$implicit;d(2),f("ngIf",e.photo_url),d(),f("ngIf",!e.photo_url),d(6),b(e.name)}}function X(a,i){if(a&1){let e=x();r(0,"div",39),p("click",function(){s(e);let t=c(2);return g(t.closeDeleteModal())}),r(1,"div",40),p("click",function(t){return s(e),g(t.stopPropagation())}),r(2,"div",41)(3,"h3"),l(4,"\xBFJubilar a tu perrete? \u{1F622}"),o(),r(5,"button",42),p("click",function(){s(e);let t=c(2);return g(t.closeDeleteModal())}),l(6,"\xD7"),o()(),r(7,"div",43)(8,"p"),l(9," \xBFEst\xE1s seguro de que quieres jubilar a "),r(10,"strong"),l(11),o(),l(12," de tu perfil? "),o(),r(13,"p",44),l(14,"Esta acci\xF3n no se puede deshacer y perder\xE1s su historial."),o()(),r(15,"div",45)(16,"button",46),p("click",function(){s(e);let t=c(2);return g(t.closeDeleteModal())}),l(17,"Cancelar"),o(),r(18,"button",47),p("click",function(){s(e);let t=c(2);return g(t.confirmDelete())}),l(19," S\xED, Eliminar "),o()()()()}if(a&2){let e,n=c(2);d(11),b((e=n.dogToDelete())==null?null:e.name)}}function Z(a,i){if(a&1){let e=x();r(0,"div",1)(1,"div",2)(2,"div",3),C(3,"img",4),r(4,"label",5),l(5," \u{1F4F7} "),r(6,"input",6),p("change",function(t){s(e);let m=c();return g(m.onFileSelected(t))}),o()()(),r(7,"div",7)(8,"div",8),u(9,R,5,1,"div",9)(10,J,7,1,"div",10),o(),r(11,"p"),l(12),o(),r(13,"span",11),l(14),D(15,"titlecase"),o()()(),r(16,"div",12)(17,"h3"),l(18,"\u{1F436} Mis Perretes"),o(),r(19,"p",13),l(20,"A\xF1ade aqu\xED a tus compa\xF1eros de Agility."),o(),r(21,"div",14)(22,"input",15),M("ngModelChange",function(t){s(e);let m=c();return y(m.newDogName,t)||(m.newDogName=t),g(t)}),p("keyup.enter",function(){s(e);let t=c();return g(t.addDog())}),o(),r(23,"button",16),p("click",function(){s(e);let t=c();return g(t.addDog())}),l(24," A\xF1adir Perro "),o()(),r(25,"div",17),u(26,K,3,0,"div",18)(27,Q,12,3,"div",19),o()(),u(28,X,20,1,"div",20),o()}if(a&2){let e=i.ngIf,n=c();d(3),f("src",n.previewUrl||e.photoURL||"assets/default-user.png",v),d(6),f("ngIf",!n.isEditingName()),d(),f("ngIf",n.isEditingName()),d(2),b(e.email),d(),f("ngClass",e.role),d(),b(S(15,11,e.role)),d(8),P("ngModel",n.newDogName),d(),f("disabled",!n.newDogName().trim()),d(3),f("ngIf",n.dogs().length===0),d(),f("ngForOf",n.dogs()),d(),f("ngIf",n.deleteModalOpen())}}var Y=class a{authService=h(W);dogService=h(B);imageCompressor=h(L);toastService=h(I);newDogName=_("");dogs=this.dogService.getDogs();deleteModalOpen=_(!1);dogToDelete=_(null);isEditingName=_(!1);editedName=_("");constructor(){w(()=>{let i=this.authService.currentUserSignal();i&&(this.dogService.loadUserDogs(),this.editedName.set(i.name))})}toggleEditName(){if(this.isEditingName.set(!this.isEditingName()),this.isEditingName()){let i=this.authService.currentUserSignal();i&&this.editedName.set(i.name)}}selectedFile=null;previewUrl=null;async onFileSelected(i){let e=i.target.files[0];e&&this.imageCompressor.compress(e).then(n=>{this.selectedFile=n;let t=new FileReader;t.onload=m=>this.previewUrl=m.target?.result,t.readAsDataURL(n),this.uploadPhoto(n)}).catch(n=>{console.error("Error compressing image:",n),this.toastService.error("Error al procesar la imagen.")})}async uploadPhoto(i){try{let e=this.authService.currentUserSignal();if(!e)return;await this.authService.updateProfile(e.name,i),this.toastService.success("Foto de perfil actualizada correctamente")}catch(e){console.error("Error uploading photo:",e);let n="Error al subir la foto";if(e.error)if(e.status===422&&e.error.errors){let t=Object.keys(e.error.errors)[0];n=e.error.errors[t][0]}else e.error.message&&(n=e.error.message);this.toastService.error(n)}}async onDogFileSelected(i,e){let n=i.target.files[0];n&&this.imageCompressor.compress(n).then(t=>{this.uploadDogPhoto(e,t)}).catch(t=>{console.error("Error compressing dog image:",t),this.toastService.error("Error al procesar la imagen del perro.")})}async uploadDogPhoto(i,e){try{await this.dogService.updateDogPhoto(i,e)}catch(n){console.error("Error uploading dog photo:",n),this.toastService.error("Error al subir la foto del perro")}}async saveName(){if(this.editedName().trim())try{await this.authService.updateProfile(this.editedName()),this.isEditingName.set(!1),this.toastService.success("Nombre actualizado correctamente")}catch(i){console.error("Error updating name:",i);let e="Error al actualizar el nombre";i.error&&i.error.message&&(e=i.error.message),this.toastService.error(e)}}async addDog(){if(!this.newDogName().trim())return;let i=this.authService.currentUserSignal();if(i)try{await this.dogService.addDog({userId:i.id,name:this.newDogName()}),this.newDogName.set("")}catch(e){console.error("Error adding dog:",e)}}deleteDog(i,e){this.dogToDelete.set({id:i,name:e}),this.deleteModalOpen.set(!0)}closeDeleteModal(){this.deleteModalOpen.set(!1),this.dogToDelete.set(null)}async confirmDelete(){let i=this.dogToDelete();i&&(await this.dogService.deleteDog(i.id),this.closeDeleteModal())}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=k({type:a,selectors:[["app-perfil"]],decls:1,vars:1,consts:[["class","perfil-container",4,"ngIf"],[1,"perfil-container"],[1,"profile-header"],[1,"avatar-container"],["alt","Avatar","referrerpolicy","no-referrer",1,"profile-avatar",3,"src"],["title","Cambiar foto",1,"camera-btn"],["type","file","accept","image/*","hidden","",3,"change"],[1,"profile-info"],[1,"name-edit-container"],["class","name-display",4,"ngIf"],["class","name-input-group",4,"ngIf"],[1,"role-badge",3,"ngClass"],[1,"dogs-section"],[1,"section-desc"],[1,"add-dog-form"],["type","text","placeholder","Nombre de tu perro...",3,"ngModelChange","keyup.enter","ngModel"],[1,"btn-add",3,"click","disabled"],[1,"dogs-list"],["class","empty-state",4,"ngIf"],["class","dog-card",4,"ngFor","ngForOf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"name-display"],["title","Editar nombre",1,"btn-icon-edit",3,"click"],[1,"name-input-group"],["type","text",1,"edit-name-input",3,"ngModelChange","keyup.enter","ngModel"],[1,"edit-actions"],[1,"btn-check",3,"click"],[1,"btn-cancel-edit",3,"click"],[1,"empty-state"],[1,"dog-card"],[1,"dog-icon-container"],["class","dog-avatar","referrerpolicy","no-referrer",3,"src","alt",4,"ngIf"],["class","dog-icon",4,"ngIf"],["title","Cambiar foto",1,"camera-btn-dog"],[1,"dog-info"],[1,"dog-name"],["title","Eliminar",1,"btn-delete",3,"click"],["referrerpolicy","no-referrer",1,"dog-avatar",3,"src","alt"],[1,"dog-icon"],[1,"modal-overlay",3,"click"],[1,"modal-content","glass-effect",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"modal-body"],[1,"note","warning"],[1,"modal-actions"],[1,"btn-cancel",3,"click"],[1,"btn-confirm","btn-delete-action",3,"click"]],template:function(e,n){e&1&&u(0,Z,29,13,"div",0),e&2&&f("ngIf",n.authService.userProfileSignal())},dependencies:[F,E,N,V,A,z,U,j,T],styles:[".perfil-container[_ngcontent-%COMP%]{max-width:800px;margin:2rem auto;padding:2rem;background-color:#fff;border-radius:12px;box-shadow:0 4px 6px #0000000d}.profile-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px;padding-bottom:2rem;border-bottom:1px solid #eee;margin-bottom:2rem}.avatar-container[_ngcontent-%COMP%]{position:relative;display:inline-block}.profile-avatar[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid var(--accent-orange);flex-shrink:0}.camera-btn[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;background-color:var(--primary-blue);color:#fff;border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;border:2px solid white;box-shadow:0 2px 4px #0003;transition:transform .2s}.camera-btn[_ngcontent-%COMP%]:hover{transform:scale(1.1);background-color:#004494}.profile-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:var(--primary-blue);word-break:break-word}.name-edit-container[_ngcontent-%COMP%]{margin-bottom:5px}.name-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.btn-icon-edit[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;font-size:1rem;opacity:.5;transition:opacity .2s;padding:5px}.btn-icon-edit[_ngcontent-%COMP%]:hover{opacity:1}.name-input-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.edit-name-input[_ngcontent-%COMP%]{padding:6px 10px;border:1px solid var(--primary-blue);border-radius:6px;font-size:1.1rem;font-weight:700;color:#333;width:200px}.edit-actions[_ngcontent-%COMP%]{display:flex;gap:5px}.btn-check[_ngcontent-%COMP%], .btn-cancel-edit[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;font-size:1.1rem;padding:4px;transition:transform .1s}.btn-check[_ngcontent-%COMP%]:hover, .btn-cancel-edit[_ngcontent-%COMP%]:hover{transform:scale(1.2)}.profile-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0 0;color:#666;word-break:break-all}.role-badge[_ngcontent-%COMP%]{display:inline-block;margin-top:8px;padding:2px 8px;border-radius:12px;font-size:.75rem;font-weight:600;background-color:#eee;color:#666;text-transform:uppercase}.role-badge.admin[_ngcontent-%COMP%]{background-color:#ffebee;color:#d32f2f}.role-badge.staff[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.role-badge.member[_ngcontent-%COMP%]{background-color:#e8f5e9;color:#2e7d32}.dogs-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#333;font-size:1.5rem}.section-desc[_ngcontent-%COMP%]{color:#777;margin-bottom:1.5rem}.add-dog-form[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:2rem}.add-dog-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:12px 15px;border:1px solid #ddd;border-radius:6px;font-size:1rem;min-width:0}.btn-add[_ngcontent-%COMP%]{background-color:var(--primary-blue);color:#fff;border:none;padding:0 20px;border-radius:6px;cursor:pointer;font-weight:700;transition:background .2s;white-space:nowrap}.btn-add[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#004494}.btn-add[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.dogs-list[_ngcontent-%COMP%]{display:grid;gap:10px;grid-template-columns:repeat(auto-fill,minmax(100%,1fr))}.dog-card[_ngcontent-%COMP%]{display:flex;align-items:center;background-color:#f9f9f9;padding:15px;border-radius:8px;border:1px solid #eee;transition:transform .2s}.dog-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);border-color:#ddd}.dog-icon-container[_ngcontent-%COMP%]{position:relative;display:inline-block;margin-right:15px;flex-shrink:0}.dog-avatar[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;object-fit:cover;border:2px solid var(--accent-orange);display:block}.camera-btn-dog[_ngcontent-%COMP%]{position:absolute;bottom:-5px;right:-5px;background-color:var(--primary-blue);color:#fff;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:10px;border:2px solid white;box-shadow:0 1px 3px #0003;transition:transform .2s}.camera-btn-dog[_ngcontent-%COMP%]:hover{transform:scale(1.1);background-color:#004494}.dog-icon[_ngcontent-%COMP%]{font-size:1.5rem;background-color:#fff;width:50px;height:50px;display:flex;align-items:center;justify-content:center;border-radius:50%;box-shadow:0 2px 4px #0000000d}.dog-info[_ngcontent-%COMP%]{flex:1;min-width:0}.dog-name[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem;color:#333;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.btn-delete[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;font-size:1.2rem;opacity:.6;transition:opacity .2s;padding:10px}.btn-delete[_ngcontent-%COMP%]:hover{opacity:1}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#999;font-style:italic;background-color:#f9f9f9;border-radius:8px}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);animation:_ngcontent-%COMP%_fadeIn .3s ease}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:16px;width:90%;max-width:450px;box-shadow:0 20px 50px #0003;animation:_ngcontent-%COMP%_slideUp .3s ease;border:1px solid rgba(0,0,0,.1)}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#333;font-size:1.4rem}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:1.5rem;cursor:pointer;color:#999;transition:color .2s}.close-btn[_ngcontent-%COMP%]:hover{color:#333}.modal-body[_ngcontent-%COMP%]{margin-bottom:2rem;color:#444;line-height:1.6;font-size:1.05rem}.note[_ngcontent-%COMP%]{display:block;margin-top:1rem;font-size:.9rem;font-style:italic;background-color:#fff1f2;padding:10px;border-radius:6px}.note.warning[_ngcontent-%COMP%]{color:#d32f2f;border-left:4px solid #d32f2f}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem}.btn-cancel[_ngcontent-%COMP%]{background:#f0f0f0;color:#666;border:none;padding:.8rem 1.5rem;border-radius:8px;font-weight:600;cursor:pointer;transition:background .2s}.btn-cancel[_ngcontent-%COMP%]:hover{background:#e0e0e0}.btn-confirm[_ngcontent-%COMP%]{border:none;padding:.8rem 1.5rem;border-radius:8px;font-weight:600;cursor:pointer;color:#fff;transition:transform .2s,background-color .2s}.btn-delete-action[_ngcontent-%COMP%]{background:#dc3545;box-shadow:0 4px 10px #dc35454d}.btn-delete-action[_ngcontent-%COMP%]:hover{background-color:#c82333;transform:translateY(-2px);box-shadow:0 6px 15px #dc354566}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}@media(max-width:600px){.perfil-container[_ngcontent-%COMP%]{margin:1rem;padding:1.5rem}.profile-header[_ngcontent-%COMP%]{flex-direction:column;text-align:center;gap:15px}.profile-avatar[_ngcontent-%COMP%]{width:100px;height:100px}.profile-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.4rem}.add-dog-form[_ngcontent-%COMP%]{flex-direction:column}.btn-add[_ngcontent-%COMP%]{width:100%;padding:12px}.dogs-list[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{Y as Perfil};
