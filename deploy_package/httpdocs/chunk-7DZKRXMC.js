import{h as A}from"./chunk-5IX6VKFG.js";import{a as G}from"./chunk-26CPPEHR.js";import"./chunk-UPS7OBSK.js";import{k as U,l as I,o as T}from"./chunk-EZCYVLCX.js";import{Cb as P,Ea as k,Eb as M,Fb as E,Gb as o,Ha as a,Hb as g,Ib as _,Va as O,Wb as w,X as x,Zb as S,_a as u,a as C,aa as m,b as y,ba as p,jb as d,kb as t,lb as n,mb as b,na as v,qb as h,ub as f,vb as c}from"./chunk-FRQHPZYJ.js";function D(i,r){i&1&&(t(0,"div",10),o(1," No hay usuarios registrados (excepto staff). "),n())}function N(i,r){if(i&1){let e=h();t(0,"tr")(1,"td",12),b(2,"img",13),t(3,"span"),o(4),n()(),t(5,"td"),o(6),n(),t(7,"td")(8,"span",14),o(9),n()(),t(10,"td")(11,"button",15),f("click",function(){let s=m(e).$implicit,V=c(3);return p(V.initiateToggleMember(s))}),o(12),n()()()}if(i&2){let e=r.$implicit;a(2),d("src",e.photoURL||"assets/default-avatar.png",k),a(2),g(e.displayName),a(2),g(e.email),a(2),E(e.role),a(),_(" ",e.role==="member"?"Miembro":"Usuario"," "),a(2),M("promote",e.role!=="member")("revoke",e.role==="member"),a(),_(" ",e.role==="member"?"\u2B07\uFE0F Quitar Miembro":"\u2B06\uFE0F Hacer Miembro"," ")}}function z(i,r){if(i&1&&(t(0,"table")(1,"thead")(2,"tr")(3,"th"),o(4,"Usuario"),n(),t(5,"th"),o(6,"Email"),n(),t(7,"th"),o(8,"Estado"),n(),t(9,"th"),o(10,"Acciones"),n()()(),t(11,"tbody"),u(12,N,13,11,"tr",11),n()()),i&2){let e=c(2);a(12),d("ngForOf",e.displayUsers())}}function q(i,r){if(i&1&&(t(0,"div",7),u(1,D,2,0,"div",8)(2,z,13,1,"table",9),n()),i&2){let e=c();a(),d("ngIf",e.displayUsers().length===0),a(),d("ngIf",e.displayUsers().length>0)}}function R(i,r){if(i&1&&(t(0,"p"),o(1," \xBFEst\xE1s seguro de que quieres hacer miembro a "),t(2,"strong"),o(3),n(),o(4,"? "),b(5,"br"),t(6,"span",24),o(7,"Esto le dar\xE1 acceso a las funciones de miembro."),n()()),i&2){let e=c(2);a(3),g(e.selectedUser==null?null:e.selectedUser.displayName)}}function j(i,r){if(i&1&&(t(0,"p"),o(1," \xBFEst\xE1s seguro de que quieres quitarle la membres\xEDa a "),t(2,"strong"),o(3),n(),o(4,"? "),b(5,"br"),t(6,"span",25),o(7,"Perder\xE1 el acceso a las funciones de miembro."),n()()),i&2){let e=c(2);a(3),g(e.selectedUser==null?null:e.selectedUser.displayName)}}function B(i,r){if(i&1){let e=h();t(0,"div",16),f("click",function(){m(e);let s=c();return p(s.closeModal())}),t(1,"div",17),f("click",function(s){return m(e),p(s.stopPropagation())}),t(2,"div",18)(3,"h3"),o(4),n(),t(5,"button",19),f("click",function(){m(e);let s=c();return p(s.closeModal())}),o(6,"\xD7"),n()(),t(7,"div",20),u(8,R,8,1,"p",9)(9,j,8,1,"p",9),n(),t(10,"div",21)(11,"button",22),f("click",function(){m(e);let s=c();return p(s.closeModal())}),o(12,"Cancelar"),n(),t(13,"button",23),f("click",function(){m(e);let s=c();return p(s.confirmToggle())}),o(14),n()()()()}if(i&2){let e=c();a(4),g(e.confirmationAction==="promote"?"\xBFAscender Usuario?":"\xBFRevocar Membres\xEDa?"),a(4),d("ngIf",e.confirmationAction==="promote"),a(),d("ngIf",e.confirmationAction==="revoke"),a(4),M("btn-promote",e.confirmationAction==="promote")("btn-revoke",e.confirmationAction==="revoke"),a(),_(" ",e.confirmationAction==="promote"?"S\xED, Hacer Miembro":"S\xED, Revocar"," ")}}function Y(i,r){i&1&&(t(0,"div",26),b(1,"div",27),t(2,"p"),o(3,"Cargando usuarios..."),n()())}var F=class i{authService=x(A);toastService=x(G);users=v([]);loading=v(!0);displayUsers=S(()=>this.users().filter(r=>r.role!=="admin"&&r.role!=="staff"));async ngOnInit(){await this.loadUsers()}async loadUsers(){this.loading.set(!0);try{let r=await this.authService.getAllUsers();this.users.set(r)}catch(r){console.error("Error loading users",r),this.toastService.error("Error al cargar usuarios")}finally{this.loading.set(!1)}}selectedUser=null;confirmationAction=null;isModalOpen=!1;initiateToggleMember(r){this.selectedUser=r,this.confirmationAction=r.role==="member"?"revoke":"promote",this.isModalOpen=!0,document.body.style.overflow="hidden"}closeModal(){this.isModalOpen=!1,this.selectedUser=null,this.confirmationAction=null,document.body.style.overflow="auto"}async confirmToggle(){if(!this.selectedUser||!this.confirmationAction)return;let r=this.selectedUser,e=this.confirmationAction==="promote"?"member":"user";this.closeModal();try{await this.authService.updateUserRole(r.id,e),this.users.update(l=>l.map(s=>s.uid===r.uid?y(C({},s),{role:e}):s)),this.toastService.success(`Rol de ${r.displayName} actualizado a ${e==="member"?"Miembro":"Usuario"}`)}catch(l){console.error("Error updating role",l),this.toastService.error("Error al cambiar rol")}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-gestionar-miembros"]],decls:14,vars:4,consts:[["loader",""],[1,"admin-container"],[1,"header"],[1,"stats"],[1,"info-banner"],["class","table-container glass-effect",4,"ngIf","ngIfElse"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"table-container","glass-effect"],["class","empty-state",4,"ngIf"],[4,"ngIf"],[1,"empty-state"],[4,"ngFor","ngForOf"],[1,"user-cell"],["alt","Avatar","referrerpolicy","no-referrer",1,"avatar",3,"src"],[1,"badge"],[1,"action-btn",3,"click"],[1,"modal-overlay",3,"click"],[1,"modal-content","glass-effect",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"modal-body"],[1,"modal-actions"],[1,"btn-cancel",3,"click"],[1,"btn-confirm",3,"click"],[1,"note"],[1,"note","warning"],[1,"loader-container"],[1,"spinner"]],template:function(e,l){if(e&1&&(t(0,"div",1)(1,"div",2)(2,"h1"),o(3,"Gesti\xF3n de Miembros"),n(),t(4,"div",3)(5,"span"),o(6),n()()(),t(7,"div",4)(8,"p"),o(9,'\u2139\uFE0F Aqu\xED puedes gestionar qui\xE9n tiene acceso como "Miembro" (y por tanto, a las funciones de miembro).'),n()(),u(10,q,3,2,"div",5)(11,B,15,8,"div",6)(12,Y,4,0,"ng-template",null,0,w),n()),e&2){let s=P(13);a(6),_("Usuarios: ",l.displayUsers().length),a(4),d("ngIf",!l.loading())("ngIfElse",s),a(),d("ngIf",l.isModalOpen)}},dependencies:[T,U,I],styles:["[_nghost-%COMP%]{display:block;min-height:100vh;padding-top:80px;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);padding-bottom:2rem}.admin-container[_ngcontent-%COMP%]{max-width:1000px;margin:0 auto;padding:0 1rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}h1[_ngcontent-%COMP%]{color:#036;font-size:2.2rem;margin:0}.stats[_ngcontent-%COMP%]{background:#fff;padding:.5rem 1rem;border-radius:20px;font-weight:600;color:#666;box-shadow:0 2px 5px #0000000d}.info-banner[_ngcontent-%COMP%]{background:#fff3cd;color:#856404;padding:1rem;border-radius:8px;margin-bottom:1.5rem;border:1px solid #ffeeba;display:flex;align-items:center}.glass-effect[_ngcontent-%COMP%]{background:#fffffff2;border-radius:16px;padding:1rem;box-shadow:0 8px 32px #1f26871a;overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem;text-align:left;border-bottom:1px solid #eee}th[_ngcontent-%COMP%]{font-weight:600;color:#666;text-transform:uppercase;font-size:.85rem;letter-spacing:.5px}.user-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;font-weight:500;color:#333}.avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;object-fit:cover;background:#eee}.badge[_ngcontent-%COMP%]{padding:.4rem .8rem;border-radius:20px;font-size:.85rem;font-weight:700;display:inline-block}.badge.user[_ngcontent-%COMP%]{background:#f0f0f0;color:#666}.badge.member[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32;border:1px solid #c8e6c9}.action-btn[_ngcontent-%COMP%]{border:none;padding:.6rem 1.2rem;border-radius:6px;font-weight:600;cursor:pointer;transition:all .2s;font-size:.9rem}.action-btn.promote[_ngcontent-%COMP%]{background:#036;color:#fff}.action-btn.promote[_ngcontent-%COMP%]:hover{background:#024;transform:translateY(-2px);box-shadow:0 4px 8px #0363}.action-btn.revoke[_ngcontent-%COMP%]{background:#fff;color:#d32f2f;border:1px solid #ffcdd2}.action-btn.revoke[_ngcontent-%COMP%]:hover{background:#ffebee}.loader-container[_ngcontent-%COMP%]{padding:3rem;text-align:center;color:#666}.spinner[_ngcontent-%COMP%]{width:30px;height:30px;border:3px solid #f3f3f3;border-top:3px solid #003366;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 1rem}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media(max-width:768px){.action-btn[_ngcontent-%COMP%]{width:100%;margin-top:.5rem}}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);animation:_ngcontent-%COMP%_fadeIn .3s ease}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:16px;width:90%;max-width:500px;box-shadow:0 20px 50px #0003;animation:_ngcontent-%COMP%_slideUp .3s ease}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#036;font-size:1.5rem}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:1.5rem;cursor:pointer;color:#999}.modal-body[_ngcontent-%COMP%]{margin-bottom:2rem;color:#444;line-height:1.6}.note[_ngcontent-%COMP%]{display:block;margin-top:.5rem;font-size:.9rem;color:#666;font-style:italic}.note.warning[_ngcontent-%COMP%]{color:#d32f2f}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem}.btn-cancel[_ngcontent-%COMP%]{background:#f0f0f0;color:#666;border:none;padding:.8rem 1.5rem;border-radius:8px;font-weight:600;cursor:pointer;transition:background .2s}.btn-cancel[_ngcontent-%COMP%]:hover{background:#e0e0e0}.btn-confirm[_ngcontent-%COMP%]{border:none;padding:.8rem 1.5rem;border-radius:8px;font-weight:600;cursor:pointer;color:#fff;transition:transform .2s}.btn-promote[_ngcontent-%COMP%]{background:#036}.btn-revoke[_ngcontent-%COMP%]{background:#d32f2f}.btn-confirm[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 10px #00000026}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}"]})};export{F as GestionarMiembrosComponent};
