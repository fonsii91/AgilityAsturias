import{Ea as S,ba as f,ea as P,ta as U,x as p}from"./chunk-V4F4V7VE.js";import{a as y,b as a,c as b,f as v,g as w,h as A,i as g,m as N}from"./chunk-ZMUGLBPJ.js";import{G as d,H as m}from"./chunk-KMKEUFOK.js";import{Mb as s,Q as h,la as n}from"./chunk-WYX5KYRP.js";import{a as u,b as c}from"./chunk-7CGTOI24.js";var D=class l{auth;firestore;currentUserSignal=n(null);userProfileSignal=n(null);checkAuthLoading=n(!0);constructor(){let e;try{e=m()}catch{e=d(N.firebase)}this.auth=S(e),this.firestore=b(e),f(this.auth,async r=>{this.currentUserSignal.set(r),r?await this.fetchUserProfile(r):this.userProfileSignal.set(null),this.checkAuthLoading.set(!1)})}async fetchUserProfile(e){let r=a(this.firestore,"users",e.uid),t=await v(r);if(t.exists())this.userProfileSignal.set(t.data());else{let i={uid:e.uid,email:e.email||"",displayName:e.displayName||"",photoURL:e.photoURL||"",role:"user"};await A(r,i),this.userProfileSignal.set(i)}}getAuthState(){return new Promise(e=>{let r=f(this.auth,t=>{r(),e(t)})})}async loginWithGoogle(){let e=new p;try{return(await U(this.auth,e)).user}catch(r){throw console.error("Error logging in with Google",r),r}}async logout(){try{await P(this.auth),this.currentUserSignal.set(null),this.userProfileSignal.set(null)}catch(e){throw console.error("Error logging out",e),e}}isLoggedIn=s(()=>!!this.currentUserSignal());isMember=s(()=>{let e=this.userProfileSignal();return["member","staff","admin"].includes(e?.role||"")});isStaff=s(()=>{let e=this.userProfileSignal();return["staff","admin"].includes(e?.role||"")});isAdmin=s(()=>this.userProfileSignal()?.role==="admin");async getAllUsers(){let e=y(this.firestore,"users");return(await w(e)).docs.map(t=>t.data())}async updateUserRole(e,r){let t=a(this.firestore,"users",e);await g(t,{role:r});let i=this.currentUserSignal();if(i&&i.uid===e){let o=this.userProfileSignal();o&&this.userProfileSignal.set(c(u({},o),{role:r}))}}async updateDisplayName(e){let r=this.auth.currentUser;if(!r)throw new Error("No user logged in");let t=a(this.firestore,"users",r.uid);await g(t,{displayName:e}),await import("./chunk-LJ5SUPRU.js").then(o=>o.updateProfile(r,{displayName:e}));let i=this.userProfileSignal();i&&this.userProfileSignal.set(c(u({},i),{displayName:e}))}static \u0275fac=function(r){return new(r||l)};static \u0275prov=h({token:l,factory:l.\u0275fac,providedIn:"root"})};export{D as a};
